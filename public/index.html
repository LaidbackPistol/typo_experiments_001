<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Update the title tag to your desired name -->
  <title>EN5EMBLE Collectif</title>

  <!-- Basic metadata -->
  <meta name="description" content="EN5EMBLE est un collectif de gens qui mixx">

  <!-- Open Graph metadata (used by many platforms for previews) -->
  <meta property="og:title" content="EN5EMBLE Collectif">
  <meta property="og:description" content="EN5EMBLE est un collectif de gens qui mixx">
  <meta property="og:image" content="https://yourdomain.com/path/to/logo.jpg">
  <meta property="og:url" content="https://typo001.laidbackpistol.xyz">
  <meta property="og:type" content="website">

  <!-- Twitter Card metadata -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="EN5EMBLE Collectif">
  <meta name="twitter:description" content="EN5EMBLE est un collectif de gens qui mixx">
  <meta name="twitter:image" content="https://yourdomain.com/path/to/logo.jpg">

  <!-- Theme color for browser UI elements and media notifications -->
  <meta name="theme-color" content="#ffff00">

  <!-- Web App Manifest for better mobile experience -->
  <link rel="manifest" href="/manifest.json">

  <!-- Basic favicon -->
  <link rel="icon" href="/favicon.ico" sizes="any">

  <!-- PNG versions for modern browsers -->
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">

  <!-- Apple Touch Icon for iOS devices -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">

  <!-- For Android and modern browsers (SVG favicon) -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">

  <!-- Web App Manifest (also helps with PWA support) -->
  <link rel="manifest" href="/site.webmanifest">

  <!-- Microsoft Windows tile icons -->
  <meta name="msapplication-TileColor" content="#ffff00">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">

  <!-- Safari pinned tab icon -->
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffff00">

  <!-- Theme color affects browser UI in some browsers -->
  <meta name="theme-color" content="#ffff00">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Alfa+Slab+One&family=Bebas+Neue&family=Cinzel:wght@700&family=Comfortaa:wght@700&family=DM+Serif+Display&family=Faster+One&family=Permanent+Marker&family=Righteous&family=Rubik+Glitch&family=Russo+One&family=Special+Elite&family=VT323&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Doto:wght,ROND@200,4&family=Offside&family=Rubik+Puddles&family=Silkscreen&family=Tulpen+One&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Arimo:ital,wght@0,400..700;1,400..700&family=Big+Shoulders:opsz,wght@10..72,100..900&family=Inknut+Antiqua:wght@300;400;500;600;700;800;900&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: monospace;
      overflow: hidden;
      background-color: #000;
      color: #fff;
      height: 100vh;
      width: 100vw;
      cursor: crosshair;
    }

    #canvas-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1; /* Behind everything */
    }

    /* NEW RULE: When fullscreen viewer is active, move canvas up in z-index */
    .fullscreen-viewer.active ~ #canvas-container {
      z-index: 290 !important; /* Just below the fullscreen viewer */
    }

    /* NEW RULE: When the fullscreen viewer is active, hide other page elements */
    .fullscreen-viewer.active ~ .archive-gallery {
      visibility: hidden;
    }

    /* Menu container */
    .menu-container {
      position: fixed;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      z-index: 100;
    }

    .main-menu ul {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 20px;
      transition: all 0.4s ease;
    }

    .main-menu li {
      position: relative;
      transition: all 0.4s ease;
    }

    .menu-item {
      color: #ffff00; /* Yellow text color */
      font-size: 22px; /* Increased from 18px */
      text-decoration: none;
      transition: all 0.4s ease;
      font-family: monospace;
      opacity: 0.9;
      display: inline-block;
    }

    /* Increase size for active menu items on desktop */
    .menu-item.active {
      font-size: 28px; /* Increased from 24px */
      font-weight: bold;
      opacity: 1;
      transform: translateX(5px);
    }

    /* Fix for persistent hover states on mobile */
    @media (hover: hover) {
      /* Only apply hover effects on devices that actually support hover */
      .menu-item:hover {
        opacity: 0.6;
        cursor: pointer;
      }
    }

    @media (hover: none) {
      /* For touch devices, remove the hover state */
      .menu-item:hover {
        opacity: 0.9; /* Same as default */
      }
      
      /* Add a "pressed" state for touch feedback instead */
      .menu-item:active {
        opacity: 0.6;
        transition: opacity 0.1s;
      }
      
      /* Make sure active items maintain their proper opacity */
      .menu-item.active, 
      .menu-item.active:hover,
      .menu-item.active:active {
        opacity: 1;
      }
    }

    /* Additional fix for iOS devices which have known issues with hover states */
    @supports (-webkit-touch-callout: none) {
      .menu-item {
        -webkit-tap-highlight-color: transparent; /* Remove default iOS tap highlight */
      }
      
      .menu-item:hover {
        opacity: 0.9; /* Reset to default on iOS */
      }
    }
    /* Push items away from active item */
    li.active-item ~ li {
      transform: translateY(8px);
    }
    
    li:not(.active-item) + li.active-item ~ li {
      transform: translateY(8px);
    }
    
    /* Media query for responsive design */
    @media (max-width: 768px) {
      /* Keep all menu items on the same baseline */
      .menu-container {
        top: auto;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
      }

      .main-menu ul {
        flex-direction: row;
        justify-content: center;
        gap: 15px;
        align-items: baseline; /* Important: align items by their baseline */
      }

      .menu-item {
        font-size: 18px;
        transform: translateY(0); /* Remove vertical shift */
        position: relative; /* For z-index control */
        display: inline-block;
        line-height: 1.2; /* Consistent line height */
        vertical-align: baseline; /* Keep text aligned at baseline */
      }
      
      .menu-item.active {
        font-size: 24px;
        transform: translateX(0); /* No position change, just size */
        z-index: 5; /* Keep active item on top */
      }
      
      /* Change how siblings are moved to avoid vertical shift */
      li.active-item ~ li {
        transform: translateX(8px);
        transform-origin: left center; /* Keep transform centered vertically */
      }
      
      li:not(.active-item) + li.active-item ~ li {
        transform: translateX(8px);
        transform-origin: left center; /* Keep transform centered vertically */
      }
      
      /* Add margin adjustment to compensate for font size change */
      li.active-item {
        margin-bottom: 0; /* Prevent margin from affecting layout */
      }
    }

   /* ==========================================
      ARCHIVE GALLERY - MAIN STYLES
      ========================================== */
    .archive-gallery {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: transparent;
      z-index: 200;
      overflow-y: auto;
      display: none;
      padding: 60px 20px 20px 20px;
      pointer-events: none; /* Make the entire gallery click-through by default */
    }

    .archive-gallery.active {
      display: block;
    }

    /* Gallery container */
    .gallery-container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: transparent;
    }

    /* Album styling - restore pointer events */
    .album {
      margin-bottom: 80px;
      background-color: transparent;
      pointer-events: auto; /* Re-enable pointer events for album elements */
    }

    /* Album title */
    .album-title {
      color: #ffff00;
      font-size: 18px;
      margin-bottom: 4px;
      font-family: monospace;
      text-shadow: 0 0 10px rgba(0, 0, 0, 0.8), 0 0 20px rgba(0, 0, 0, 0.8);
      pointer-events: auto; /* Ensure title is clickable */
    }

    /* Album images - playful layout */
    .album-images {
      display: flex;
      flex-wrap: wrap;
      position: relative;
      margin: 10px -15px;
      padding: 20px 0;
      background-color: transparent;
      pointer-events: auto;
    }

    /* Individual image containers */
    .album-image {
      position: relative;
      margin: -20px;  /* Negative margin for overlap */
      padding: 5px;
      background-color: transparent;
      pointer-events: auto;
      width: auto;
      height: auto;
      transition: all 0.3s ease;
      z-index: 1;
      transform-origin: center;
    }

    .album-image:hover {
      z-index: 10;
      transform: scale(1.08) rotate(0deg) !important;
    }

    .album-image img {
      max-width: 750px;  /* Increased from 350px */
      max-height: 600px; /* Increased from 280px */
      width: auto;
      height: auto;
      object-fit: contain;
      transition: all 0.3s ease;
      border: none;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
    }

    /* ==========================================
      MIXES GALLERY - MAIN STYLES
      ========================================== */
    .mixes-gallery {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: transparent;
      z-index: 200;
      overflow-y: auto;
      display: none;
      padding: 60px 20px 20px 20px;
      pointer-events: none; /* This makes it click-through by default */
    }

    .mixes-gallery.active {
      display: block;
    }

    /* Mix container - base styles for all screen sizes */
    .mix-container {
      margin-bottom: 30px;
      padding: 0;
      pointer-events: auto;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      background-color: transparent;
      border: none;
      opacity: 1;
    }

    .soundcloud-embed {
      width: 100%;
      margin-bottom: 10px;
      background-color: transparent;
      padding: 0;
      border-radius: 0;
    }

    .mix-title {
      color: #ffff00; /* Same yellow as your menu items */
      font-family: monospace; /* To match your menu style */
      display: none;
    }

    /* ==========================================
      FULLSCREEN VIEWER - UPDATED
    ========================================== */
    .fullscreen-viewer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: transparent; /* Completely transparent background */
      z-index: 300;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .fullscreen-viewer.active {
      display: flex;
    }

    /* When fullscreen viewer is active, move canvas container up in the stacking order */
    .fullscreen-viewer.active ~ #canvas-container,
    body.fullscreen-mode #canvas-container {
      z-index: 290 !important; /* Just below the fullscreen viewer */
    }

    /* When in fullscreen mode, hide UI elements except for the viewer */
    body.fullscreen-mode .menu-container,
    body.fullscreen-mode .archive-gallery,
    body.fullscreen-mode .mixes-gallery {
      visibility: hidden !important;
    }

    /* Hide cursor when initially viewing in fullscreen */
    body.viewing-fullscreen {
      cursor: none;
    }

    /* Show cursor when moving the mouse */
    body.viewing-fullscreen:hover {
      cursor: auto;
    }

    /* Make sure the fullscreen viewer is always visible */
    body.fullscreen-mode .fullscreen-viewer {
      visibility: visible !important;
    }

    /* Viewer controls styling for better visibility */
    .viewer-controls {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: space-between;
      padding: 20px;
      box-sizing: border-box;
      z-index: 301; /* Above the viewer */
    }

    .viewer-controls button {
      background: rgba(0, 0, 0, 0.7);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      width: 50px;
      height: 50px;
      border-radius: 50%;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s ease;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    }

    .viewer-controls button:hover {
      background: rgba(50, 50, 50, 0.9);
      border-color: rgba(255, 255, 255, 0.5);
    }

    .close-button {
      position: fixed;
      top: 20px;
      right: 20px;
    }

    .prev-button, .next-button {
      position: fixed;
      top: 50%;
      transform: translateY(-50%);
    }

    .prev-button {
      left: 20px;
    }

    .next-button {
      right: 20px;
    }

    .viewer-image-container {
      width: 90%;
      height: 90%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 300;
    }

    .image-caption {
      position: absolute;
      bottom: 20px;
      left: 0;
      width: 100%;
      text-align: center;
      color: white;
      padding: 10px;
      background: rgba(0, 0, 0, 0.7);
      font-family: monospace;
      border-radius: 4px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      z-index: 301; /* Above the image */
    }

    /* Responsive adjustments for fullscreen viewer */
    @media screen and (min-width: 1200px) {
      /* For larger screens, make images even bigger */
      .viewer-image-container {
        width: 98%;
        height: 98%;
      }
      
      .viewer-image {
        max-width: 98%;
        max-height: 98%;
      }
    }

    @media screen and (max-width: 768px) {
      /* For mobile, ensure controls are big enough to tap */
      .viewer-controls button {
        width: 44px;
        height: 44px;
      }
      
      /* Reduce any unnecessary padding */
      .fullscreen-viewer {
        padding: 0;
      }
      
      /* Position the close button better on mobile */
      .close-button {
        top: 10px;
        right: 10px;
      }
    }

    /* ==========================================
      MENU TYPOGRAPHY
      ========================================== */
    .menu-item {
      color: #ffff00; /* Yellow text color */
      font-size: 22px; /* Increased from 18px */
      text-decoration: none;
      transition: all 0.4s ease;
      font-family: monospace;
      opacity: 0.9;
      display: inline-block;
    }

    .menu-item.active {
      font-size: 28px; /* Increased from 24px */
      font-weight: bold;
      opacity: 1;
      transform: translateX(5px);
    }

    /* ==========================================
      ANIMATIONS
      ========================================== */
    @keyframes fadeSlideIn {
      from {
        opacity: 0;
        transform: translateY(20px) rotate(0deg);
      }
      to {
        opacity: 1;
        transform: translateY(0) rotate(var(--rotation));
      }
    }

    /* ==========================================
      DESKTOP STYLES (min-width: 769px)
      ========================================== */
    @media (min-width: 769px) {
      /* Archive Gallery - Desktop */
      .archive-gallery {
        padding-left: 200px; /* Make space for the menu */
        padding-right: 20px; /* Default right padding */
        box-sizing: border-box;
      }
      
      .archive-gallery .gallery-container {
        max-width: 100%; /* Use full width */
        margin-left: 0;
      }
      
      .album-images {
        gap: 10px; /* Increased gap for better visual spacing on desktop */
      }
      
      /* Mixes Gallery - Desktop */
      .mixes-gallery {
        padding-left: 200px; /* Make space for the menu */
        padding-right: 20px; /* Default right padding */
        box-sizing: border-box;
        perspective: 1000px; /* For parallax effect */
      }
      
      .mixes-gallery .gallery-container {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        grid-auto-rows: minmax(100px, auto);
        gap: 20px;
        padding: 20px;
        max-width: 100%; /* Use full width */
        margin-left: 0;
      }
      
      /* Mix container desktop styles */
      .mix-container {
        grid-column: span 12;
        max-width: none;
        margin: 0;
        position: relative;
        transform-origin: center;
        transition: transform 0.3s ease-out, opacity 0.3s ease;
        width: 100%;
        box-sizing: border-box;
      }
      
      /* Expanded column spans to utilize more space */
      .mix-container:nth-child(4n+1) {
        grid-column: 1 / span 10;
        transform: rotate(-1deg);
      }
      
      .mix-container:nth-child(4n+2) {
        grid-column: 2 / span 10;
        transform: rotate(1deg);
      }
      
      .mix-container:nth-child(4n+3) {
        grid-column: 1 / span 10;
        transform: rotate(0.5deg);
      }
      
      .mix-container:nth-child(4n+4) {
        grid-column: 2 / span 10;
        transform: rotate(-0.5deg);
      }
      
      /* Hover effects */
      .mix-container:hover {
        transform: scale(1.02) rotate(0);
        z-index: 10;
      }
      
      /* Make soundcloud embeds more visually interesting */
      .soundcloud-embed {
        filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.3));
        transition: all 0.3s ease;
        transform-origin: center;
      }
      
      .soundcloud-embed iframe {
        max-width: 100%;
      }
      
      .mix-container:hover .soundcloud-embed {
        filter: drop-shadow(0 8px 25px rgba(0, 0, 0, 0.4));
      }
      
      /* Enhance mix titles */
      .mix-title {
        transform: translateY(0);
        transition: transform 0.2s ease;
        text-shadow: 0 0 15px rgba(0, 0, 0, 0.6);
      }
      
      .mix-container:hover .mix-title {
        transform: translateY(-5px);
      }
    }

    /* ==========================================
      MOBILE STYLES (max-width: 768px)
      ========================================== */
    @media (max-width: 768px) {
      /* Menu Typography - Mobile */
      .menu-item {
        font-size: 18px; /* Original size for mobile */
      }
      
      .menu-item.active {
        font-size: 24px; /* Original size for mobile */
      }
      
      /* Archive Gallery - Mobile */
      .album {
        margin-bottom: 84px;
        text-align: left;
      }
      
      /* Update album images for mobile - wider with significant overlap */
      .album-images {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        margin: 10px auto;
        padding: 0;
        /* Remove any grid settings that might cause spacing */
        grid-template-columns: unset;
        gap: 0;
      }
      
      .album-title {
        font-size: 18px;
        margin-bottom: 18px;
      }

      .album-image {
        margin: -15px; /* Much more aggressive negative margin for overlap */
        padding: 0; /* Remove any padding */
        width: auto;
        height: auto;
        display: inline-block;
        position: relative;
        transform: rotate(0deg) !important; /* Reset any rotations initially */
        transition: all 0.3s ease;
        z-index: 1; /* Default z-index */
      }
      
      /* Random rotation for each image */
      .album-image:nth-child(3n+1) {
        transform: rotate(-3deg) !important;
      }
      
      .album-image:nth-child(3n+2) {
        transform: rotate(3deg) !important;
      }
      
      .album-image:nth-child(3n+3) {
        transform: rotate(1deg) !important;
      }
      
      .album-image:hover {
        z-index: 20 !important; /* Much higher z-index on hover */
        transform: scale(1.08) rotate(0deg) !important;
      }
      
      .album-image img {
        max-width: 40px; /* Significantly increased from 260px */
        max-height: 40px; /* Significantly increased from 220px */
        width: auto;
        height: auto;
        display: block;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        object-fit: contain;
        border: 0;
        padding: 0;
        margin: 0;
      }
      
      .archive-gallery {
        
        padding: 60px 10px 70px 10px; /* Add bigger bottom padding (70px) to make room for menu */
        height: calc(100% - 64px); /* Reduce height to leave space for menu */
        bottom: 64px; /* Position above the menu bar */
        max-height: calc(100% - 64px); /* Set max height to ensure visibility of menu */
      }
      
      /* Mixes Gallery - Mobile */
      .mixes-gallery {
        padding: 60px 10px 70px 10px; /* Add bigger bottom padding (70px) to make room for menu */
        height: calc(100% - 64px); /* Reduce height to leave space for menu */
        bottom: 64px; /* Position above the menu bar */
        max-height: calc(100% - 64px); /* Set max height to ensure visibility of menu */
        box-sizing: border-box; /* Ensure padding is included in height calculation */
      }
      
      /* Improve padding and spacing for mix containers on mobile */
      .mix-container {
        margin-bottom: 40px; /* Increase space between mixes */
        padding-bottom: 10px; /* Add some padding at bottom */
      }
      
      /* Ensure the last mix doesn't get cut off */
      .mix-container:last-child {
        margin-bottom: 80px; /* Extra space at the end of the list */
      }
      
      /* Ensure Soundcloud embeds are fully visible */
      .soundcloud-embed {
        margin-bottom: 15px;
      }
    }
    
    body.fullscreen-mode .mixes-gallery,
    body.fullscreen-mode .archive-gallery {
      visibility: hidden !important;
    }

    /* When fullscreen viewer is closed and section is active, ensure visibility */
    .mixes-gallery.active {
      visibility: visible !important; 
      display: block !important;
    }

    .archive-gallery.active {
      overflow-x: hidden !important; /* Prevent horizontal scrolling */
      visibility: visible !important;
      display: block !important;
    }

    /* Ensure visible embeds in mixes gallery */
    .mixes-gallery.active .soundcloud-embed {
      visibility: visible !important;
      display: block !important;
    }

    .mixes-gallery.active .soundcloud-embed iframe {
      visibility: visible !important;
      display: block !important;
    }

    /* Events section styles */
    .events-gallery {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: transparent;
      z-index: 200;
      overflow-y: auto;
      display: none;
      padding: 60px 20px 20px 20px;
      pointer-events: none;
    }
    
    .events-gallery.active {
      display: block;
    }

    .floating-heads-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 50; /* Above canvas but below UI elements */
      transition: opacity 0.5s ease;
    }
  </style>
  <link rel="stylesheet" href="/floating-heads.css">
  <link rel="stylesheet" href="/future-events.css">
  <link rel="stylesheet" href="/gradient-controls.css">
</head>
<body>
  <div id="canvas-container">
    <!-- Canvas container for gradient background -->
  </div>
  <!-- Events gallery -->
  <div id="events-gallery" class="events-gallery">
    <div class="gallery-container">
      <div class="events-placeholder">
        <div class="circular-text-container">
          <svg id="circular-text-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <path id="circular-text-path" d="M50,90 a40,40 0 1,1 0,-80 a40,40 0 1,1 0,80z"/>
            <text>
              <textPath href="#circular-text-path" id="spinning-text" startOffset="0%">STAY TUNED          STAY TUNED          </textPath>
            </text>
          </svg>
        </div>
      </div>
      <!-- Future events will be loaded here dynamically -->
    </div>
  </div>
  <!-- Archive gallery -->
  <div id="archive-gallery" class="archive-gallery">
    <div class="gallery-container">
      <!-- Albums will be loaded here dynamically -->
    </div>
  </div>
  <!-- Mixes gallery -->
  <div id="mixes-gallery" class="mixes-gallery">
    <div class="gallery-container">
      <!-- Mixes will be loaded here dynamically -->
    </div>
  </div>
  <!-- Fullscreen Image Viewer -->
  <div id="fullscreen-viewer" class="fullscreen-viewer">
    <div class="viewer-controls">
      <button class="prev-button">&lt;</button>
      <button class="next-button">&gt;</button>
      <button class="close-button">×</button>
    </div>
    <div class="viewer-image-container">
      <img class="viewer-image" src="" alt="">
    </div>
  </div>
  <div class="menu-container">
    <nav class="main-menu">
      <ul>
        <li><a href="#events" class="menu-item" data-section="events">events</a></li>
        <li><a href="#mixxs" class="menu-item" data-section="mixxs">mixxs</a></li>
        <li><a href="#archives" class="menu-item" data-section="archives">archives</a></li>
        <li><a href="#contact" class="menu-item" data-section="contact">contact</a></li>
      </ul>
    </nav>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Menu setup
      setupMenu();
      // Check if URL has a hash and select the corresponding menu item
      checkUrlHash();

      // Variables for the archive gallery
      const archiveMenuItem = document.querySelector('.menu-item[data-section="archives"]');
      const archiveGallery = document.getElementById('archive-gallery');
      const galleryContainer = archiveGallery.querySelector('.gallery-container');
      
      // Variables for the mixes gallery
      const mixxsMenuItem = document.querySelector('.menu-item[data-section="mixxs"]');
      const mixesGallery = document.getElementById('mixes-gallery');
      const mixesContainer = mixesGallery.querySelector('.gallery-container');

      // Variables for events gallery
      const eventsMenuItem = document.querySelector('.menu-item[data-section="events"]');
      const eventsGallery = document.getElementById('events-gallery');

      // Fullscreen Viewer Variables
      const fullscreenViewer = document.getElementById('fullscreen-viewer');
      const prevButton = fullscreenViewer.querySelector('.prev-button');
      const nextButton = fullscreenViewer.querySelector('.next-button');
      const closeViewerButton = fullscreenViewer.querySelector('.close-button');
      const viewerImage = fullscreenViewer.querySelector('.viewer-image');
      
      let currentImageIndex = 0;
      let currentGalleryImages = [];

      // Track loaded content 
      let archiveContentLoaded = false;
      let mixesContentLoaded = false;
      let eventsContentLoaded = false;

      // Menu setup function
      function setupMenu() {
        const menuItems = document.querySelectorAll('.menu-item');
        
        // Menu item click handler
        menuItems.forEach(item => {
          item.addEventListener('click', (e) => {
            e.preventDefault();
            
            const clickedItem = e.target;
            const parentLi = clickedItem.parentElement;
            const section = clickedItem.getAttribute('data-section');
            
            // Hide all sections first
            if (section !== 'archives' && archiveGallery.classList.contains('active')) {
              archiveGallery.classList.remove('active');
            }
            
            if (section !== 'mixxs' && mixesGallery.classList.contains('active')) {
              mixesGallery.classList.remove('active');
            }

            if (section !== 'events' && eventsGallery.classList.contains('active')) {
              eventsGallery.classList.remove('active');
            }
            
            // Toggle active state or update URL
            if (clickedItem.classList.contains('active')) {
              // If already active, deactivate and clear URL hash
              clickedItem.classList.remove('active');
              parentLi.classList.remove('active-item');
              history.pushState(null, '', window.location.pathname); // Remove hash from URL
            } else {
              // First, remove active class from all items
              menuItems.forEach(i => {
                i.classList.remove('active');
                i.parentElement.classList.remove('active-item');
              });
              
              // Then, add active class to clicked item
              clickedItem.classList.add('active');
              parentLi.classList.add('active-item');
              
              // Update URL without navigation - using History API
              history.pushState(null, '', `#${section}`);

              // Show the appropriate section
              if (section === 'archives') {
                if (!archiveContentLoaded) {
                  loadArchiveContent();
                  archiveContentLoaded = true;
                }
                archiveGallery.classList.add('active');
              } 
              else if (section === 'mixxs') {
                if (!mixesContentLoaded) {
                  loadMixesContent();
                  mixesContentLoaded = true;
                }
                mixesGallery.classList.add('active');
              }
              else if (section === 'events') {
                if (!eventsContentLoaded) {
                  loadEventsContent();
                  eventsContentLoaded = true;
                }
                eventsGallery.classList.add('active');
              }
            }
            
            // Simple feedback animation
            const originalColor = window.getComputedStyle(clickedItem).color;
            clickedItem.style.color = '#ffffff';
            
            setTimeout(() => {
              clickedItem.style.color = '';
            }, 200);
          });
        });
      }

      // Check URL hash and set appropriate section
      function checkUrlHash() {
        // First, clear all active states
        const allMenuItems = document.querySelectorAll('.menu-item');
        allMenuItems.forEach(item => {
          item.classList.remove('active');
          item.parentElement.classList.remove('active-item');
        });
        
        // Hide all sections
        archiveGallery.classList.remove('active');
        mixesGallery.classList.remove('active');
        eventsGallery.classList.remove('active');
        
        // Then, if there's a hash, find and activate the corresponding menu item
        if (window.location.hash) {
          const section = window.location.hash.substring(1); // Remove the # character
          const menuItem = document.querySelector(`.menu-item[data-section="${section}"]`);
          
          if (menuItem) {
            menuItem.classList.add('active');
            menuItem.parentElement.classList.add('active-item');
            
            // Show the appropriate section
            if (section === 'archives') {
              if (!archiveContentLoaded) {
                loadArchiveContent();
                archiveContentLoaded = true;
              }
              archiveGallery.classList.add('active');
            } 
            else if (section === 'mixxs') {
              if (!mixesContentLoaded) {
                loadMixesContent();
                mixesContentLoaded = true;
              }
              mixesGallery.classList.add('active');
            }
            else if (section === 'events') {
              if (!eventsContentLoaded) {
                loadEventsContent();
                eventsContentLoaded = true;
              }
              eventsGallery.classList.add('active');
            }
          }
        }
      }

      // Function to load archive content
      async function loadArchiveContent() {
        try {
          galleryContainer.innerHTML = '<div style="color: white; text-align: center; padding: 50px;">Fetching archives...</div>';
          
          const response = await fetch('/api/archives');
          const data = await response.json();
          
          galleryContainer.innerHTML = '';
          
          if (!data.albums || data.albums.length === 0) {
            galleryContainer.innerHTML = '<div style="color: white; text-align: center; padding: 50px;">No archives found. Add folders to the archive_assets directory.</div>';
            return;
          }
          
          // Create and append album elements
          data.albums.forEach(album => {
            const albumElement = createAlbumElement(album);
            galleryContainer.appendChild(albumElement);
          });
          
          // Setup for mobile or desktop
          const isMobile = window.innerWidth <= 768;
          if (isMobile) {
            // Force visibility on all images on mobile
            setTimeout(() => {
              document.querySelectorAll('.album-image img').forEach(img => {
                if (!img.src || img.src.includes('data:image')) {
                  img.src = img.getAttribute('data-src');
                }
                img.style.display = 'block';
                img.style.visibility = 'visible';
                img.style.opacity = '1';
              });
            }, 500);
          } else {
            // Desktop uses normal lazy loading
            setupLazyLoading();
          }
          
          // Setup click events
          setupImageClickEvents();
          setupImageHoverEffects();
        } catch (error) {
          console.error('Error loading archives:', error);
          galleryContainer.innerHTML = `<div style="color: white; text-align: center; padding: 50px;">
            Error loading archives: ${error.message || 'Unknown error'}
          </div>`;
        }
      }

      // Function to create an album element
      function createAlbumElement(album) {
        const albumElement = document.createElement('div');
        albumElement.className = 'album';
        
        const titleElement = document.createElement('h2');
        titleElement.className = 'album-title';
        titleElement.textContent = album.title;
        albumElement.appendChild(titleElement);
        
        const imagesContainer = document.createElement('div');
        imagesContainer.className = 'album-images';
        
        // On mobile, use a simpler layout
        const isMobile = window.innerWidth <= 768;
        
        album.images.forEach((image, index) => {
          const imageContainer = document.createElement('div');
          imageContainer.className = 'album-image';
          
          if (!isMobile) {
            // Only apply fancy effects on desktop
            // Add random rotation between -8 and 8 degrees
            const randomRotation = (Math.random() * 16 - 8).toFixed(1);
            imageContainer.style.transform = `rotate(${randomRotation}deg)`;
            
            // Random z-index for natural layering
            imageContainer.style.zIndex = Math.floor(Math.random() * 5) + 1;
            
            // Store original z-index for later reference
            imageContainer.dataset.zIndex = imageContainer.style.zIndex;
          } else {
            // Simpler mobile version
            const randomMobileRotation = [(Math.random() * 6 - 3).toFixed(1)];
            imageContainer.style.transform = `rotate(${randomMobileRotation}deg)`;
            imageContainer.style.display = "inline-block";
            imageContainer.style.margin = "-15px";
            imageContainer.style.padding = "0";
            imageContainer.style.position = "relative";
          }
          
          const img = document.createElement('img');
          img.alt = image.alt || 'Gallery image';
          
          // For mobile, load immediately
          if (isMobile) {
            img.src = image.src;
            img.style.display = 'block';
            img.style.maxWidth = '800px';
            img.style.maxHeight = '800px';
            img.style.width = 'auto';
            img.style.height = 'auto';
            img.style.objectFit = 'contain';
            img.style.margin = '0';
            img.style.padding = '0';
          } else {
            // Desktop lazy loading
            img.setAttribute('data-src', image.src);
            img.src = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1 1"%3E%3C/svg%3E';
          }
          
          imageContainer.appendChild(img);
          imagesContainer.appendChild(imageContainer);
        });
        
        albumElement.appendChild(imagesContainer);
        return albumElement;
      }

      // Function to setup lazy loading for images
      function setupLazyLoading() {
        if ('IntersectionObserver' in window) {
          const lazyImageObserver = new IntersectionObserver(entries => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                const lazyImage = entry.target;
                const src = lazyImage.getAttribute('data-src');
                
                if (src) {
                  lazyImage.src = src;
                  lazyImage.removeAttribute('data-src');
                }
                
                lazyImageObserver.unobserve(lazyImage);
              }
            });
          });
          
          const lazyImages = document.querySelectorAll('img[data-src]');
          lazyImages.forEach(img => lazyImageObserver.observe(img));
        } else {
          // Fallback for browsers that don't support Intersection Observer
          const lazyImages = document.querySelectorAll('img[data-src]');
          lazyImages.forEach(img => {
            img.src = img.getAttribute('data-src');
            img.removeAttribute('data-src');
          });
        }
      }

      // Set up hover effects for images
      function setupImageHoverEffects() {
        document.querySelectorAll('.album-image').forEach(image => {
          image.addEventListener('mouseenter', function() {
            this.style.zIndex = '20'; // Higher than any random z-index
          });
          
          image.addEventListener('mouseleave', function() {
            // Restore the previous z-index after a delay
            setTimeout(() => {
              if (!this.matches(':hover')) {
                this.style.zIndex = this.dataset.zIndex || '1';
              }
            }, 300);
          });
        });
      }

      // Set up click events for opening the fullscreen viewer
      function setupImageClickEvents() {
        document.querySelectorAll('.album-image').forEach((imageContainer) => {
          imageContainer.addEventListener('click', (e) => {
            // Find which album this image belongs to
            const albumElement = e.currentTarget.closest('.album');
            const allImages = albumElement.querySelectorAll('.album-image img');
            
            // Collect image data
            currentGalleryImages = Array.from(allImages).map(img => ({
              src: img.getAttribute('data-src') || img.src,
              alt: img.alt
            }));
            
            // Set current index
            currentImageIndex = Array.from(albumElement.querySelectorAll('.album-image')).indexOf(e.currentTarget);
            
            // Update and show viewer
            updateViewerImage();
            fullscreenViewer.classList.add('active');
          });
        });
      }

      // Update the displayed image in the fullscreen viewer
      function updateViewerImage() {
        if (!viewerImage || currentGalleryImages.length === 0 || currentImageIndex < 0 || currentImageIndex >= currentGalleryImages.length) {
          return;
        }
        
        const imageData = currentGalleryImages[currentImageIndex];
        viewerImage.src = imageData.src;
        viewerImage.alt = imageData.alt || '';
        
        // Optional: Show image caption
        let caption = fullscreenViewer.querySelector('.image-caption');
        if (imageData.alt) {
          if (!caption) {
            caption = document.createElement('div');
            caption.className = 'image-caption';
            fullscreenViewer.querySelector('.viewer-image-container').appendChild(caption);
          }
          caption.textContent = imageData.alt;
          caption.style.display = 'block';
        } else if (caption) {
          caption.style.display = 'none';
        }
      }

      // Fullscreen viewer controls
      if (closeViewerButton) {
        closeViewerButton.addEventListener('click', () => {
          fullscreenViewer.classList.remove('active');
        });
      }

      if (prevButton) {
        prevButton.addEventListener('click', () => {
          if (currentGalleryImages.length === 0) return;
          
          currentImageIndex = (currentImageIndex - 1 + currentGalleryImages.length) % currentGalleryImages.length;
          updateViewerImage();
        });
      }

      if (nextButton) {
        nextButton.addEventListener('click', () => {
          if (currentGalleryImages.length === 0) return;
          
          currentImageIndex = (currentImageIndex + 1) % currentGalleryImages.length;
          updateViewerImage();
        });
      }

      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        if (!fullscreenViewer.classList.contains('active')) return;
        
        if (e.key === 'Escape') {
          fullscreenViewer.classList.remove('active');
        } else if (e.key === 'ArrowLeft') {
          if (prevButton) prevButton.click();
        } else if (e.key === 'ArrowRight') {
          if (nextButton) nextButton.click();
        }
      });

      // Function to load mixes content
      async function loadMixesContent() {
        try {
          mixesContainer.innerHTML = '<div style="color: white; text-align: center; padding: 50px;">Loading mixes...</div>';
          
          const response = await fetch('/api/mixes');
          const data = await response.json();
          
          mixesContainer.innerHTML = '';
          
          if (!data.mixes || data.mixes.length === 0) {
            mixesContainer.innerHTML = '<div style="color: white; text-align: center; padding: 50px;">No mixes found. Add tracks to the mixes.json file.</div>';
            return;
          }
          
          // Create and append mix elements with index
          data.mixes.forEach((mix, index) => {
            const mixElement = createMixElement(mix, index);
            mixesContainer.appendChild(mixElement);
          });
          
          // Add parallax effect for desktop only
          if (window.innerWidth >= 768) {
            setupParallaxEffect();
          }
        } catch (error) {
          console.error('Error loading mixes:', error);
          mixesContainer.innerHTML = '<div style="color: white; text-align: center; padding: 50px;">Error loading mixes. Please try again later.</div>';
        }
      }

      // Function to create a mix element
      function createMixElement(mix, index) {
        const mixElement = document.createElement('div');
        mixElement.className = 'mix-container';
        
        // Only add special effects for desktop
        if (window.innerWidth >= 768) {
          // Add random rotation variable for animation
          const randomRotation = (Math.random() * 2 - 1) * 1.5; // Between -1.5 and 1.5 degrees
          mixElement.style.setProperty('--rotation', `${randomRotation}deg`);
          
          // Add animation with delay based on index
          mixElement.style.animation = `fadeSlideIn 0.5s ease forwards ${index * 0.15}s`;
          mixElement.style.opacity = '0'; // Start invisible for animation
        }
        
        // Add title element
        const titleElement = document.createElement('h2');
        titleElement.className = 'mix-title';
        titleElement.textContent = mix.title || 'Untitled Mix';
        mixElement.appendChild(titleElement);
        
        // Create metadata element (artist and date)
        const metadataElement = document.createElement('div');
        metadataElement.className = 'mix-metadata';
        
        // Format the date nicely
        const mixDate = new Date(mix.date);
        const formattedDate = mixDate.toLocaleDateString(undefined, {
          year: 'numeric',
          month: 'short',
          day: 'numeric'
        });
        
        // Show artist and date
        metadataElement.textContent = `${mix.artist} • ${formattedDate}`;
        mixElement.appendChild(metadataElement);
        
        // Create Soundcloud embed
        const embedContainer = document.createElement('div');
        embedContainer.className = 'soundcloud-embed';
        
        // Use the provided embed code
        if (mix.embedCode) {
          embedContainer.innerHTML = mix.embedCode;
        } else if (mix.soundcloudUrl || mix.soundcloudId) {
          // Create iframe for Soundcloud embed (fallback method)
          const iframe = document.createElement('iframe');
          iframe.width = '100%';
          iframe.height = '200';
          iframe.scrolling = 'no';
          iframe.frameBorder = 'no';
          iframe.allow = 'autoplay';
          
          if (mix.soundcloudId) {
            iframe.src = `https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/${mix.soundcloudId}&color=%23ffff00&auto_play=false&hide_related=true&show_comments=false&show_user=true&show_reposts=false&show_teaser=false&visual=true`;
          } else if (mix.soundcloudUrl) {
            const encodedUrl = encodeURIComponent(mix.soundcloudUrl);
            iframe.src = `https://w.soundcloud.com/player/?url=${encodedUrl}&color=%23ffff00&auto_play=false&hide_related=true&show_comments=false&show_user=true&show_reposts=false&show_teaser=false&visual=true`;
          }
          
          embedContainer.appendChild(iframe);
        }
        
        mixElement.appendChild(embedContainer);
        
        return mixElement;
      }

      // Function to set up parallax effect for mixes gallery
      function setupParallaxEffect() {
        const mixesGallery = document.getElementById('mixes-gallery');
        
        mixesGallery.addEventListener('mousemove', (e) => {
          // Only apply on desktop
          if (window.innerWidth < 768) return;
          
          const containers = document.querySelectorAll('.mix-container');
          const mouseX = e.clientX / window.innerWidth - 0.5; // -0.5 to 0.5
          const mouseY = e.clientY / window.innerHeight - 0.5; // -0.5 to 0.5
          
          containers.forEach((container, index) => {
            // Calculate a different intensity for each container
            const intensity = 10 + (index % 3) * 5; // Varies between 10, 15, 20
            
            // Apply transform based on mouse position
            container.style.transform = `
              translateX(${mouseX * intensity}px) 
              translateY(${mouseY * intensity}px)
              rotate(${container.style.getPropertyValue('--rotation') || '0deg'})
            `;
          });
        });
        
        // Reset positions when mouse leaves
        mixesGallery.addEventListener('mouseleave', () => {
          const containers = document.querySelectorAll('.mix-container');
          
          containers.forEach((container) => {
            container.style.transform = `rotate(${container.style.getPropertyValue('--rotation') || '0deg'})`;
          });
        });
      }

      // Function to load events content
      function loadEventsContent() {
        if (!eventsGallery) return;
        
        try {
          // Show placeholder for now - future events will be loaded here
          const eventsPlaceholder = eventsGallery.querySelector('.events-placeholder');
          if (eventsPlaceholder) {
            eventsPlaceholder.style.display = 'flex';
          }
          
          // Fetch events data from API (will be implemented in the future)
          fetch('/api/events')
            .then(response => response.json())
            .then(data => {
              console.log('Events data:', data);
              
              // For now, just display the placeholder
              if (eventsPlaceholder) {
                eventsPlaceholder.style.display = 'flex';
              }
            })
            .catch(error => {
              console.error('Error loading events:', error);
              if (eventsPlaceholder) {
                eventsPlaceholder.style.display = 'flex';
              }
            });
        } catch (error) {
          console.error('Error loading events:', error);
        }
      }

      // Listen for back/forward browser navigation
      window.addEventListener('popstate', () => {
        checkUrlHash();
      });
      
      // Also listen for hash changes directly (for manual URL edits)
      window.addEventListener('hashchange', checkUrlHash);
    });
  </script>
  <script src="/floating-heads.js"></script>
  <script src="/soundcloud-integration.js"></script>
  <script src="/music-indicator.js"></script>
  <script src="/events-content.js"></script>
  <script src="/shake-detector.js"></script>
  <script src="/gradient-background.js"></script>
</body>
</html>